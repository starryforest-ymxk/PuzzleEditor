**代码审查发现（按严重度）**

- 高 | 数据模型仍与文档不一致：[types.ts](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 的 [ProjectData](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 只含 [meta{name,version}](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)、stage/node/fsm/pres/blackboard，没有 [scripts](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 清单和 [meta.id/description/createdAt/updatedAt](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)，与 [project.ts](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 的 [ProjectData](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)/[ExportManifest](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 结构不符；[types.ts](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 仍将脚本/触发器以数组挂在 [manifest](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)，缺少 [version](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 与 [ScriptsManifest](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 的 [Record](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 形态，保存接口也无法持久化脚本清单和版本信息。
- 高 | 作用域可见性未接入黑板：[variableScope.ts](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 仍返回空的 [globalVisible](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（占位注释未更新），即便 [state.project.blackboard](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 已存在也不会被收集，导致条件/参数编辑无法访问全局变量。
- 高 | 条件/触发器编辑缺乏资源选择与合法性：[TransitionInspector.tsx](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 的 `OnEvent`/`CustomScript` 仅文本输入，未从黑板事件或脚本清单中过滤 MarkedForDelete；[ConditionEditor.tsx](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 也使用自由输入的变量 ID/Scope，没有类型校验或资源过滤。且该编辑器只读写 [left/right](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)，忽略已有的 [children](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 结构，修改后会丢弃原有条件树（例如 Mock 中 [type:'AND', children:[...\]](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 的条件）。
- 高 | 参数修改器/事件监听 UI 缺失：Transition Inspector 未暴露 [parameterModifiers](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)，Stage/Node/State 级的事件监听与参数修改也无界面入口，P1-T05/T07 的统一抽象未落地。
- 中 | 演出参数绑定的 ValueSource 被降级：[PresentationNodeInspector.tsx](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 在 [upsertParamBinding](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 中无论输入都写回 [{type:'Constant'}](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)，已有 `VariableRef` 会被覆盖，无法选择 Global/Stage/Node/Temporary 变量源；[paramValueMap](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 仅把 `VariableRef` 展示成字符串而非可编辑引用，[ScriptParamEditor](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 也只处理原始值，未对接 ValueSource 语义。
- 中 | 黑板视图与软删除流程缺位：仍只有节点局部的 [BlackboardEditor](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)；没有全局 Variables/Scripts/Events 的列表、筛选、引用查询，也没有 “标记删除/应用删除” 的操作入口，软删除只在 Node Local 变量通过 reducer 处理，其余资源没有 UI 支撑。
- 中 | 演出绑定缺口：Transition/State/Stage Inspector 未提供 [presentation](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 绑定与参数传递编辑，无法满足 UX Flow 对状态转移/生命周期演出绑定的要求。
- 低 | 编码/注释规范：[mockData.ts](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 仍有乱码注释行（`========== é»‘æ¿...`），与项目的中文注释规范不符。

**已修复的先前问题**

- 节点局部变量新增时（[BlackboardEditor.tsx](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）已补全 [key/state/scope](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 并通过 [withScope](vscode-file://vscode-app/d:/Program Files/Microsoft VS Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 归一化，解决了旧版只生成半字段、与软删除规则不一致的问题。

若需，我可以按上述发现优先修正数据模型/可见性与条件触发器编辑的对接。