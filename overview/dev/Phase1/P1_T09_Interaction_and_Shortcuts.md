# P1-T09 基础交互规范与快捷键约定（现状&准则）

> 目标：统一编辑器的基础交互（选中/多选/右键/删除/移动/缩放）与快捷键行为，并对现有实现进行对齐说明。

## 1. 交互准则（适用于各视图）

- **选中/多选**：左键选中；框选支持按住左键拖拽；Ctrl/Cmd 添加到多选；ESC 清除多选。
- **右键菜单**：右键打开上下文菜单，不影响选中；点击空白关闭。
- **删除**：Delete/Backspace 删除当前选中对象；多选时批量删除。
- **移动/拖拽**：左键拖拽元素移动；画布平移使用 Space+拖拽（或鼠标中键）；缩放使用 Ctrl/Cmd + 滚轮。
- **撤销/重做**：Ctrl/Cmd+Z 撤销；Ctrl/Cmd+Shift+Z 或 Ctrl/Cmd+Y 重做。

## 2. 快捷键总览

- 全局：
  - Undo/Redo：Ctrl/Cmd+Z，Ctrl/Cmd+Shift+Z（或 Ctrl/Cmd+Y）
- FSM 画布：
  - 删除：Delete/Backspace（支持多选）
  - 框选：左键拖拽空白区域
  - 多选：Ctrl/Cmd 点击追加
  - 平移：按 Space 或中键拖拽
  - 缩放：Ctrl/Cmd + 滚轮
  - 连接：Shift+拖拽或通过上下文“Link”
  - 线切割：Ctrl+拖拽直线（当前实现）
- 演出画布（预期与 FSM 画布保持一致）：同上，后续实现时沿用相同手势与快捷键。
- 列表/树：
  - 选中：单击
  - 展开/折叠：点击箭头

## 3. 现有实现对齐情况

- 全局撤销/重做：`components/Layout/MainLayout.tsx` 已绑定 Ctrl/Cmd+Z / Shift+Z / Y。
- FSM 画布：`StateMachineCanvas.tsx`
  - 框选、多选、删除、连接、平移、切线（Ctrl+拖）、上下文菜单 均已实现。
  - 缺少缩放手势处理（现依赖浏览器缩放）；后续可接入滚轮缩放和缩放中心逻辑。
- Stage/Node 列表：单击选中，展开/折叠由 StageExplorer 实现。
- 演出画布：尚未实现交互，需继承 FSM 的快捷键规范。

## 4. 后续补充与校验

- 在演出画布/黑板编辑等视图复用相同快捷键和交互模式，保持一致性。
- 如增加全局快捷键配置，可在单处（例如 MainLayout）集中注册并按视图上下文分发，防止冲突。
- 缩放/平移手势需在大图场景优化性能，考虑虚拟化/最小重绘策略。

## 5. 变更记录

- 2025-12-09：FSM 画布的状态节点与空白区域选中改为鼠标左键抬起触发，和连线选中时机保持一致，避免按下立即选中导致拖拽/切线手势冲突；同时当鼠标拖拽状态节点时不再触发选中，只有点击并抬起且无拖拽位移时才会更改选中项；新增拖拽监听改为捕获阶段，确保 MouseUp 总能释放拖拽状态，避免节点在鼠标抬起后仍被吸附；修复框选流程会被空白选中覆盖的问题，框选时不再触发空白选中，保证多选结果保留；空白点击改为重新选中当前节点上下文，清除状态/连线选中同时保持画布可见。
