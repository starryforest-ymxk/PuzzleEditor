# 交互规范（Interaction Guide）

> 本文档定义编辑器的统一交互规范和快捷键约定，适用于所有编辑视图。
>
> **版本**: 1.0.0 | **更新时间**: 2025-12-09

---

## 1. 通用交互准则

### 1.1 选中与多选

| 操作 | 手势/快捷键 | 说明 |
|------|-------------|------|
| 单选 | 左键点击 | 选中单个对象 |
| 追加选择 | Ctrl/Cmd + 左键 | 添加到当前选中集合 |
| 框选 | 左键拖拽空白区域 | 框内对象全部选中 |
| 取消选择 | ESC 或 点击空白 | 清除所有选中 |

### 1.2 编辑操作

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| 删除 | Delete / Backspace | 删除选中对象（支持多选） |
| 撤销 | Ctrl/Cmd + Z | 撤销上一步操作 |
| 重做 | Ctrl/Cmd + Shift + Z | 恢复已撤销的操作 |
| 重做（备选） | Ctrl/Cmd + Y | 同上 |

### 1.3 画布导航

| 操作 | 手势 | 说明 |
|------|------|------|
| 平移 | Space + 左键拖拽 | 移动画布视口 |
| 平移（备选） | 中键拖拽 | 同上 |
| 平移（备选） | Alt + 左键拖拽 | 同上 |
| 缩放 | Ctrl/Cmd + 滚轮 | 放大/缩小画布 |

### 1.4 右键菜单

- 右键点击对象：显示上下文菜单
- 右键不影响当前选中状态
- 点击菜单外区域：关闭菜单

---

## 2. FSM 画布快捷键

### 2.1 节点操作

| 操作 | 手势/快捷键 | 说明 |
|------|-------------|------|
| 创建节点 | 右键 → Add State | 在点击位置创建状态节点 |
| 移动节点 | 左键拖拽节点 | 移动单个或多个选中节点 |
| 设为初始状态 | 右键 → Set Initial | 标记为状态机入口 |
| 删除节点 | Delete / Backspace | 同时删除相关连线 |

### 2.2 连线操作

| 操作 | 手势/快捷键 | 说明 |
|------|-------------|------|
| 创建连线 | Shift + 左键拖拽 | 从源节点拖向目标节点 |
| 创建连线（备选） | 右键 → Link | 进入连接模式后点击目标 |
| 选中连线 | 左键点击连线 | 选中后可在 Inspector 编辑 |
| 删除连线 | Delete / Backspace | 删除选中的连线 |
| 批量切断 | Ctrl + 左键拖拽 | 划线切断路径上的所有连线 |

### 2.3 吸附提示

- 连线时靠近目标节点边缘会显示黄色吸附点
- 吸附阈值：30px
- 吸附位置：节点四边中点（top/right/bottom/left）

---

## 3. 演出画布快捷键

> 演出画布继承 FSM 画布的交互规范，以下为特定差异。

| 操作 | 手势/快捷键 | 说明 |
|------|-------------|------|
| 创建节点 | 右键 → Add Node | 选择节点类型后创建 |
| 连接节点 | 从节点端口拖拽 | 建立顺序/分支连接 |

---

## 4. 列表与树视图

| 操作 | 手势 | 说明 |
|------|------|------|
| 选中 | 左键单击 | 选中列表项或树节点 |
| 展开/折叠 | 点击箭头图标 | 展开或折叠子节点 |
| 进入编辑 | 左键双击 | 进入详情视图或编辑模式 |

---

## 5. 实现状态

### 5.1 已实现

| 功能 | 位置 | 状态 |
|------|------|------|
| 全局撤销/重做 | `MainLayout.tsx` | ✅ |
| FSM 框选/多选 | `StateMachineCanvas.tsx` | ✅ |
| FSM 节点拖拽 | `useGraphInteraction.ts` | ✅ |
| FSM 连线创建 | `useGraphInteraction.ts` | ✅ |
| FSM 右键菜单 | `StateMachineCanvas.tsx` | ✅ |
| FSM 线切割 | `StateMachineCanvas.tsx` | ✅ |
| 画布平移 | `useCanvasNavigation.ts` | ✅ |

### 5.2 待实现

| 功能 | 说明 |
|------|------|
| 画布缩放 | 需接入滚轮缩放和缩放中心逻辑 |
| 演出画布交互 | 继承 FSM 规范，待实现 |
| 黑板视图交互 | 阶段二任务 |

---

## 6. 变更记录

- **2025-12-09**: 从 Phase1/P1_T09 提炼为独立文档
- **2025-12-09**: FSM 画布选中改为鼠标抬起触发，避免与拖拽冲突
- **2025-12-09**: 修复框选被空白选中覆盖的问题
