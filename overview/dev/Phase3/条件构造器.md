### Condition Builder 内部布局

- **Logic Bar（顶部一行）**
  - 左侧：逻辑模式选择 `AND / ANY / NOT`（作用于“当前组”）
    - `AND / ANY`：支持**2+** 子条件
    - `NOT`：仅支持 **1** 子条件（结果取反）
  - 右侧：`+ Add` 主按钮，下拉菜单：
    - `Add Condition`（直接创建 COMPARE 条件）
    - `Add Group`（创建可嵌套的逻辑组）
- **Condition List（中部列表，支持嵌套）**
  - 列表项分两类：*Condition 行* 与 **Group 行**（组的运算结果也视为一个 Condition，可被上层组引用）
  - **Group 行**（作为容器括号）
    - 行内从左到右：折叠箭头 / Drag Handle / `GROUP`(或逻辑 Chip) / 组摘要（如`AND (3)`）/ 状态图标区
    - 展开后显示子列表（缩进一层），子列表结构与顶层一致，可继续嵌套 Group
  - **Condition 行**
    - 行内从左到右：Drag Handle / Type Chip（COMPARE / SCRIPT）/ 主内容（省略）/ 状态图标区
  - **数量约束（按组内逻辑）**
    - 组为 `NOT`：子列表最多 1 条，超过则禁用新增
    - 组为 `AND/ANY`：允许多条正常追加与排序
- **Empty State（无条件时）**
  - 允许“完全不添加任何条件/逻辑组”
  - 显示：`No conditions (Always true)`
  - 引导：点按`+ Add`添加 **Condition** 或**Group**（开始构建嵌套逻辑）

### 实现补充（P3-T06 落地要点）

- 逻辑模式按钮以 AND/ANY/NOT 展示，内部 OR 存储保持不变，NOT 自动裁剪多余子项（仅 1 个）。
- 根层单叶 Condition **直接展示**，不需要 Group 包裹；拥有多个子项时才显示为 Group。
- 根层通过 “Add Group” 新建时需保留 AND 容器，不再被“单子项拆封”逻辑折叠，确保用户确实得到条件组。
- 变量/脚本选择过滤软删，如存在历史引用缺失或软删，行内红字警示但不强制清空，兼容旧数据。
- 布尔/字符串 仅暴露 `==/!=` 操作符，数值类型提供全套比较；比较右值默认空字符串，避免自动填充 0。



### 条件构造器 UX交互

- **新增入口（Logic Bar 的 + Add）**
  - 点击 `+ Add` 打开下拉：
    - `Add Condition` → 直接创建 COMPARE 条件（可在行内切换类型）
    - `Add Group` → 创建一个可嵌套的逻辑组

#### 添加 Group：用户会看到什么

- 用户选 `Add Group` 后，在当前列表末尾插入一条 **Group 行**（默认 `AND`，子列表为空）。
- Group 行显示（从左到右）：
  - 折叠箭头（默认展开）
  - Drag Handle
  - 逻辑 Chip：`AND / ANY / NOT`
  - 摘要：`AND (0)`
  - 右侧操作区： `🗑`（Delete）
- Group 行下方立即出现**缩进的子列表区域**，并在子列表区域顶部或空状态处显示：
  - `Empty: No conditions (Always true)` + 一个小的 `+ Add`（只作用于该 Group）

#### 添加 Condition：用户会看到什么

- 用户从 `+ Add` 选择 `Add Condition`：
  - 直接插入一条 **COMPARE Condition 行**，并进入编辑态
  - 用户可在 Condition 行内通过 Type 下拉切换为 SCRIPT / VARIABLE / LITERAL
- Condition 行显示（从左到右）：
  - Type Chip：`COMPARE` / `SCRIPT`
  - 主内容：表达式或脚本名（超出省略）
  - 右侧操作区：`🗑` Delete

> 添加位置规则：在“当前容器”末尾添加
>
> - 若用户在某个 Group 内点击子列表的 `+ Add` → 加到该 Group 子列表末尾
> - 若在顶层 Logic Bar 添加 → 加到顶层末尾

#### 删除交互：入口与布局

##### Condition 怎么删

- **按钮位置**：Condition 行最右侧，放一个 `🗑`（固定在右侧操作区，不挤压主内容）
- **行为**：点击立即删除该 Condition 行
- **在 Group 中删除**：同样在该子行右侧 `🗑` 删除，仅影响该 Group 的子列表

##### Group 怎么删

- **按钮位置**：Group 行最右侧（与 Condition 相同的"右侧操作区"对齐），提供 `🗑`
- **根级 Group 删除**：点击删除后重置为 Empty State（`LITERAL true`）
- **子级 Group 删除**：点击删除后移除该 Group
- **能不能删除带 Condition 的 Group？可以**
  - 点击删除时的规则建议二选一（推荐 A）：
    - **A（推荐）**：若 Group 内有子项，弹出轻确认：
      - 文案：`Delete this group and its 3 conditions?`
      - 操作：`Delete` / `Cancel`
    - **B（无确认）**：直接删除整个 Group（包含全部子项），但需要支持 Undo（如果你们有）

##### 删除 Group 中的 Condition

- 直接点该 Condition 行右侧 `🗑`，只删除那一条
- 删除后 Group 摘要数量实时更新（如 `AND (3)` → `AND (2)`）
- 若删到 0 条，子列表显示 Empty State

#### NOT 组的特殊限制（删除/新增联动）

- 当 Group 逻辑为 `NOT`：
  - 只允许 **1 条**子条件
  - 已有 1 条时：
    - 子列表的 `+ Add` 置灰或隐藏，并提示 `NOT group allows only one condition`
  - 删除那 1 条后：
    - 子列表恢复 Empty State，并允许再次添加 1 条

#### 小结：用户操作路径（最短心智模型）

- `+ Add Group` → 生成一个“带括号的容器行”，下面出现缩进子列表（可继续 Add）
- `+ Add Condition` → 生成一条可编辑的条件行
- `🗑` 永远在每一行最右侧：
  - 删 Condition：删这一行
  - 删 Group：删整组（可带确认），组内条件随组一起删除
  - 删组内条件：在子行右侧删

