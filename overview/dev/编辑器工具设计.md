# Unity 编辑器工具设计 (精简版)

> **设计原则**：Unity 编辑器是**辅助工具**，所有配置工作在前端完成，Unity 只负责数据校验、脚本绑定检查、运行时监控和调试。  
> **Unity 版本**：2022.3  
> **技术栈**：UI Toolkit / IMGUI

---

## 📋 功能概览

| 模块 | 职责 | 使用场景 |
|------|------|----------|
| **结构预览** | 只读展示阶段/节点/状态结构 | 校验导入数据正确性 |
| **脚本检查** | 显示待实现脚本及绑定状态 | 提示开发进度 |
| **运行时监控** | 实时显示系统运行状态 | Play Mode 调试 |
| **测试配置** | 配置初始状态快速进入测试 | 跳过前置流程 |

---

## 🎯 模块一：结构预览 (Structure Preview)

### 功能

以**只读树形视图**展示导入的项目结构，用于快速校验数据正确性。

### 界面

```
┌─────────────────────────────────────────────────────────┐
│  结构预览 (Structure Preview)             [刷新]        │
├─────────────────────────────────────────────────────────┤
│  📁 Bubble Horror                                       │
│  └─📂 Stages                                            │
│     ├─📌 初遇异常 [FirstEncounterException]             │
│     │  └─🧩 邦邦罗的对话 [ChatWithNPC]                  │
│     │     └─🔄 2 States: InWorld, Destroyed             │
│     │  └─🧩 发现失踪人员传单 [Found_Flayers]            │
│     │     └─🔄 2 States: ...                            │
│     ├─📌 进入房屋 [EnterHouse]                          │
│     │  └─🧩 发现采购单 [PurchaseOrderDiscovered]        │
│     │  └─🧩 前往地下室的门 [BasementDoor]               │
│     └─📌 ...                                            │
├─────────────────────────────────────────────────────────┤
│  统计: 8 Stages, 17 Nodes, 43 States                    │
└─────────────────────────────────────────────────────────┘
```

### 显示内容

| 元素 | 显示信息 |
|------|----------|
| Stage | 名称 + AssetName + 子 Stage 数量 |
| PuzzleNode | 名称 + AssetName |
| FSM | 状态数量 + 状态名称列表 |

### 交互

- **展开/折叠**：点击节点展开查看子元素
- **搜索**：输入关键词过滤显示
- **复制 AssetName**：右键 → 复制

> ⚠️ **不显示**：解锁条件详情、变量详情、生命周期脚本配置等（这些在前端查看）

---

## 🎯 模块二：脚本实现检查 (Script Implementation Checker)

### 功能

显示项目中所有待实现的脚本及其实现状态，帮助开发者追踪进度。

### 界面

```
┌─────────────────────────────────────────────────────────┐
│  脚本实现检查 (Script Checker)            [刷新]        │
├─────────────────────────────────────────────────────────┤
│  实现进度: ████████░░ 12 / 15 (80%)                     │
├─────────────────────────────────────────────────────────┤
│  [全部] [未实现] [已实现]                 🔍 搜索...     │
├─────────────────────────────────────────────────────────┤
│  ⚠️ 未实现 (3)                                          │
│  ┌─────────────────────────────────────────────────────┐│
│  │ 🎬 PowerOutagePerformance                          ││
│  │    类型: Performance | 基类: 已生成                 ││
│  │    [创建脚本]                                       ││
│  ├─────────────────────────────────────────────────────┤│
│  │ ♻️ Monster                                          ││
│  │    类型: Lifecycle (Node) | 基类: 已生成            ││
│  │    [创建脚本]                                       ││
│  ├─────────────────────────────────────────────────────┤│
│  │ ❓ TriggerMonsterCustomCondition                   ││
│  │    类型: Condition | 基类: 已生成                   ││
│  │    [创建脚本]                                       ││
│  └─────────────────────────────────────────────────────┘│
│                                                         │
│  ✅ 已实现 (12)                                         │
│  ┌─────────────────────────────────────────────────────┐│
│  │ 🎬 NpcFlashPerformance → NpcFlashPerformance.cs    ││
│  │ ♻️ BubbleEmitingState → BubbleEmitingStateScript.cs││
│  │ ♻️ Stage_FindingBubble → FindingBubbleStage.cs     ││
│  │ ...                                                 ││
│  └─────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────┤
│  [全部创建未实现脚本] [导出检查报告]                     │
└─────────────────────────────────────────────────────────┘
```

### 显示内容

| 状态 | 显示信息 |
|------|----------|
| 未实现 | AssetName + 类型 + [创建脚本] 按钮 |
| 已实现 | AssetName + 绑定的实现类文件名 |

### 交互

- **创建脚本**：自动在 `Assets/Scripts/Implementation/` 创建继承正确基类的脚本
- **筛选**：按实现状态筛选
- **搜索**：按名称搜索

---

## 🎯 模块三：运行时监控 (Runtime Monitor)

### 功能

**仅在 Play Mode** 显示，实时监控系统运行状态。

### 界面

```
┌─────────────────────────────────────────────────────────┐
│  运行时监控 (Runtime Monitor)        ▶️ Running         │
├─────────────────────────────────────────────────────────┤
│  当前 Stage                                             │
│  ┌─────────────────────────────────────────────────────┐│
│  │ 📌 关闭泡泡来源 [CloseBubbleEmitter]                ││
│  │    运行时间: 00:02:15                               ││
│  └─────────────────────────────────────────────────────┘│
│                                                         │
│  活跃节点 (Active Nodes)                                │
│  ┌─────────────────────────────────────────────────────┐│
│  │ ✅ 洗衣机冒泡泡 → [Closed]                          ││
│  │ ✅ 马桶冒泡泡 → [Closed]                            ││
│  │ ⚡ 水龙头冒泡泡 → [Emitting] (当前执行中)            ││
│  └─────────────────────────────────────────────────────┘│
│                                                         │
│  演出状态                                               │
│  ┌─────────────────────────────────────────────────────┐│
│  │ ▶️ 正在播放: PowerOutagePerformance                 ││
│  │    进度: 2/5 节点                                   ││
│  └─────────────────────────────────────────────────────┘│
│  (或: ⏸️ 无演出进行中)                                  │
│                                                         │
│  变量 (Blackboard)                    [展开全部]        │
│  ┌─────────────────────────────────────────────────────┐│
│  │ 🌍 Global                                           ││
│  │    ClosedBubbleEmitterCount = 2                    ││
│  │    GasolineQuantity = 0                            ││
│  │    StartDieselGenerator = false                    ││
│  │ 📍 Stage: CloseBubbleEmitter                       ││
│  │    LaundryBubbleClosed = true                      ││
│  │    ToiletBubbleClosed = true                       ││
│  │    TapBubbleClosed = false                         ││
│  └─────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────┘
```

### 显示内容

| 区域 | 显示信息 |
|------|----------|
| 当前 Stage | Stage 名称 + AssetName + 运行时间 |
| 活跃节点 | 节点名称 + 当前 FSM 状态 |
| 演出状态 | 是否有演出进行中 + 演出名称 + 进度 |
| 变量 | Global 变量 + 当前 Stage 局部变量 + 当前 Node 局部变量 |

### 刷新机制

- 自动每 0.5 秒刷新
- 变量值变化时高亮显示

---

## 🎯 模块四：测试配置 (Test Configuration)

### 功能

配置初始状态，进入 Play Mode 后直接跳转到指定阶段，跳过前置流程。

### 界面

```
┌─────────────────────────────────────────────────────────┐
│  测试配置 (Test Configuration)                          │
├─────────────────────────────────────────────────────────┤
│  ☑️ 启用测试模式                                        │
├─────────────────────────────────────────────────────────┤
│  起始 Stage                                             │
│  ┌─────────────────────────────────────────────────────┐│
│  │ [关闭泡泡来源 ▼]                                    ││
│  └─────────────────────────────────────────────────────┘│
│                                                         │
│  PuzzleNode 激活配置                                    │
│  ┌──────────────────┬──────────┬───────────────────────┐│
│  │ 节点              │ 启用     │ 初始状态              ││
│  ├──────────────────┼──────────┼───────────────────────┤│
│  │ 洗衣机冒泡泡      │ [✓]      │ [Closed ▼]           ││
│  │ 马桶冒泡泡        │ [✓]      │ [Closed ▼]           ││
│  │ 水龙头冒泡泡      │ [✓]      │ [Emitting ▼]         ││
│  └──────────────────┴──────────┴───────────────────────┘│
│                                                         │
│  全局变量预设                                           │
│  ┌─────────────────────┬───────────────────────────────┐│
│  │ ClosedBubbleEmitter │ [2___]                        ││
│  │ GasolineQuantity    │ [0___]                        ││
│  │ StartDieselGenerator│ [□]                           ││
│  └─────────────────────┴───────────────────────────────┘│
│                                                         │
│  Stage 局部变量预设                                      │
│  ┌─────────────────────┬───────────────────────────────┐│
│  │ LaundryBubbleClosed │ [✓]                           ││
│  │ ToiletBubbleClosed  │ [✓]                           ││
│  │ TapBubbleClosed     │ [□]                           ││
│  └─────────────────────┴───────────────────────────────┘│
├─────────────────────────────────────────────────────────┤
│  配置管理                                               │
│  ┌─────────────────────────────────────────────────────┐│
│  │ 配置名称: [测试停电场景_________]                   ││
│  │ [保存配置] [加载配置 ▼] [删除配置]                  ││
│  └─────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────┤
│  [▶️ 应用配置并进入 Play Mode]                          │
└─────────────────────────────────────────────────────────┘
```

### 配置内容

| 配置项 | 描述 |
|--------|------|
| 起始 Stage | 进入 Play Mode 后直接激活此 Stage |
| Node 启用 | 选择性启用/禁用某些 PuzzleNode |
| Node 初始状态 | 设置每个 Node 的 FSM 初始状态 |
| 全局变量 | 预设全局变量值 |
| Stage 局部变量 | 预设当前 Stage 的局部变量值 |

### 配置存储

- 保存为 `ScriptableObject`
- 路径：`Assets/PuzzleSystem/TestConfigs/`
- 支持多个配置切换

---

## 📐 技术实现

### 窗口类型

| 模块 | 实现方式 |
|------|----------|
| 结构预览 | `EditorWindow` + `TreeView` |
| 脚本检查 | `EditorWindow` + `ListView` |
| 运行时监控 | `RuntimePuzzleManager` 的 Custom Inspector |
| 测试配置 | `EditorWindow` + `ScriptableObject` |

### 菜单入口

```
Window/Puzzle System/
├─ Structure Preview    (结构预览)
├─ Script Checker       (脚本检查)
└─ Test Configuration   (测试配置)
```

运行时监控通过选中 `RuntimePuzzleManager` 游戏对象在 Inspector 中查看。

---

## 📋 实现优先级

| 优先级 | 模块 | 理由 |
|--------|------|------|
| P0 | 脚本实现检查 | 开发必需，每日使用 |
| P0 | 结构预览 | 导入后校验必需 |
| P1 | 运行时监控 | 调试必需 |
| P2 | 测试配置 | 提升测试效率 |

---

## ⚠️ 设计边界

**不在 Unity 编辑器中展示的内容**（这些在前端编辑器查看）：

- ❌ 解锁条件的详细表达式
- ❌ 转移的触发器/条件/参数修改器详情
- ❌ 演出图的节点结构
- ❌ 事件的触发/监听链路
- ❌ 脚本参数绑定详情

**设计原则**：Unity 编辑器只做**校验、检查、监控、调试**，不做**配置详情展示**。
