# 校验错误清单

> 数据校验器 `DataValidator` 产出的所有校验消息，共 **64 条**（1 Critical / 55 Error / 8 Warning）。

---

## 错误代码常量

| 常量 | 值 | 定义位置 |
|---|---|---|
| `ERR_NULL_DATA` | `NULL_DATA` | DataValidator.cs |
| `ERR_INVALID_ASSET_NAME` | `INVALID_ASSET_NAME` | DataValidator.cs |
| `ERR_DUPLICATE_ASSET_NAME` | `DUPLICATE_ASSET_NAME` | DataValidator.cs |
| `ERR_MISSING_REFERENCE` | `MISSING_REFERENCE` | DataValidator.cs |
| `ERR_INVALID_FSM` | `INVALID_FSM` | DataValidator.cs |
| `ERR_CYCLE_DETECTED` | `CYCLE_DETECTED` | DataValidator.cs |
| `ERR_MISSING_INITIAL_STATE` | `MISSING_INITIAL_STATE` | DataValidator.cs |
| `ERR_INVALID_TRANSITION` | `INVALID_TRANSITION` | DataValidator.cs |
| `ERR_INVALID_GRAPH` | `INVALID_GRAPH` | DataValidator.cs |
| `ERR_ORPHAN_NODE` | `ORPHAN_NODE` | DataValidator.cs ⚠️ 已定义未使用 |
| `ERR_INVALID_PARAMETER` | `INVALID_PARAMETER` | DataValidator.cs |
| `ERR_CONFLICTING_PARAMETER_TYPE` | `CONFLICTING_PARAMETER_TYPE` | DataValidator.cs |
| `ERR_INVALID_TEMP_PARAMETER_TYPE` | `INVALID_TEMP_PARAMETER_TYPE` | DataValidator.cs |
| `ERR_MULTI_BINDING` | `MULTI_BINDING` | DataValidator.ScriptBindings.cs |

---

## 1. DataValidator.cs — 顶层 & AssetName 校验

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 1 | Critical | `NULL_DATA` | ManifestData is null | 传入数据为 null，校验立即中止 |
| 2 | Error | `INVALID_ASSET_NAME` | AssetName is empty | 任何资源的 assetName 为空 |
| 3 | Error | `INVALID_ASSET_NAME` | AssetName '{name}' is not a valid C# identifier | assetName 不是合法 C# 标识符 |
| 4 | Error | `DUPLICATE_ASSET_NAME` | Duplicate assetName '{name}' in {category} | 同一类别/作用域内 assetName 重复 |

## 2. DataValidator.Blackboard.cs — 黑板 & 脚本定义校验

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 5 | Warning | `NULL_DATA` | Blackboard is null | `blackboard` 为 null |
| 6 | Warning | `NULL_DATA` | Script category is empty | 脚本定义的 `category` 为空 |
| 7 | Error | `NULL_DATA` | Lifecycle script missing lifecycleType | Lifecycle 类脚本缺少 `lifecycleType` 字段 |

## 3. DataValidator.StageTree.cs — Stage 树 & Node 校验

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 8 | Error | `NULL_DATA` | StageTree is null | stageTree 为 null |
| 9 | Error | `NULL_DATA` | StageTree has no stages | stages 字典为空 |
| 10 | Error | `NULL_DATA` | StageTree rootId is empty | rootId 为空 |
| 11 | Error | `MISSING_REFERENCE` | StageTree rootId '{id}' not found in stages | rootId 指向的 Stage 不存在 |
| 12 | Error | `MISSING_REFERENCE` | Parent stage '{id}' not found | Stage 的 parentId 指向不存在的 Stage |
| 13 | Error | `MISSING_REFERENCE` | Child stage '{id}' not found | childrenIds 中含不存在的 Stage ID |
| 14 | Error | `CYCLE_DETECTED` | Cycle detected in stage tree | Stage 树存在循环引用 |
| 15 | Error | `MISSING_REFERENCE` | Node has no stageId | Node 缺少 stageId |
| 16 | Error | `MISSING_REFERENCE` | Node stageId '{id}' not found | Node 的 stageId 指向不存在的 Stage |
| 17 | Warning | `MISSING_REFERENCE` | Node has no stateMachineId | Node 没有关联状态机（非致命） |
| 18 | Error | `MISSING_REFERENCE` | StateMachine '{id}' not found | Node 的 stateMachineId 指向不存在 FSM |

## 4. DataValidator.FSM.cs — 状态机校验

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 19 | Error | `INVALID_FSM` | FSM has no states | 状态机无任何状态 |
| 20 | Error | `MISSING_INITIAL_STATE` | FSM has no initialStateId | FSM 缺少初始状态 ID |
| 21 | Error | `MISSING_INITIAL_STATE` | Initial state '{id}' not found | 初始状态 ID 指向不存在的状态 |
| 22 | Error | `INVALID_TRANSITION` | Transition has no fromStateId | 转移缺少源状态 |
| 23 | Error | `INVALID_TRANSITION` | From state '{id}' not found | 转移的源状态不存在 |
| 24 | Error | `INVALID_TRANSITION` | Transition has no toStateId | 转移缺少目标状态 |
| 25 | Error | `INVALID_TRANSITION` | To state '{id}' not found | 转移的目标状态不存在 |

## 5. DataValidator.Graph.cs — 演出图校验

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 26 | Warning | `INVALID_GRAPH` | PresentationGraph has no nodes | 演出图没有节点 |
| 27 | Warning | `INVALID_GRAPH` | PresentationGraph has no startNodeId | 演出图缺少起始节点 ID |
| 28 | Error | `INVALID_GRAPH` | Start node '{id}' not found | 起始节点 ID 指向不存在的节点 |
| 29 | Error | `INVALID_GRAPH` | Node has no type | 演出图节点缺少 type 字段 |
| 30 | Error | `MISSING_REFERENCE` | Next node '{id}' not found | nextIds 中引用了不存在的节点 |
| 31 | Warning | `INVALID_GRAPH` | Branch node should have 2 nextIds (true/false branches) | Branch 节点的 nextIds 不足 2 |
| 32 | Warning | `CYCLE_DETECTED` | Cycle detected in presentation graph (may be intentional for looping animations) | 演出图存在循环（可能是有意的循环动画） |

## 6. DataValidator.References.cs — 引用完整性校验

### 6a. 生命周期脚本引用

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 33 | Error | `MISSING_REFERENCE` | Lifecycle script '{id}' not found | Stage 生命周期脚本不存在 |
| 34 | Error | `MISSING_REFERENCE` | Lifecycle script '{id}' not found | Node 生命周期脚本不存在 |
| 35 | Error | `MISSING_REFERENCE` | Lifecycle script '{id}' not found | State 生命周期脚本不存在 |

### 6b. 事件引用

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 36 | Error | `MISSING_REFERENCE` | Event '{id}' not found | Transition 的 invokeEventIds 引用不存在的事件 |

### 6c. 变量引用

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 37 | Error | `MISSING_REFERENCE` | Target variable '{id}' not found{scopeInfo} | 参数修改器目标变量不存在 |
| 38 | Error | `MISSING_REFERENCE` | Source variable '{id}' not found{scopeInfo} | 参数修改器值来源变量不存在 |

### 6d. 触发器

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 39 | Error | `NULL_DATA` | Trigger type is empty | 触发器缺少 type 字段 |
| 40 | Error | `MISSING_REFERENCE` | OnEvent trigger missing eventId | OnEvent 触发器缺少 eventId |
| 41 | Error | `MISSING_REFERENCE` | Event '{id}' not found | OnEvent 触发器的事件不存在 |
| 42 | Error | `MISSING_REFERENCE` | CustomScript trigger missing scriptId | CustomScript 触发器缺少 scriptId |
| 43 | Error | `MISSING_REFERENCE` | Script '{id}' not found | CustomScript 触发器的脚本不存在 |

### 6e. 条件表达式

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 44 | Error | `NULL_DATA` | Condition type is empty | 条件缺少 type |
| 45 | Error | `MISSING_REFERENCE` | SCRIPT_REF missing scriptId | SCRIPT_REF 条件缺少 scriptId |
| 46 | Error | `MISSING_REFERENCE` | Script '{id}' not found | SCRIPT_REF 的脚本不存在 |

### 6f. 参数修改器结构

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 47 | Error | `MISSING_REFERENCE` | ParameterModifier missing targetVariableId | 参数修改器缺少目标变量 ID |
| 48 | Error | `NULL_DATA` | ParameterModifier missing operation | 参数修改器缺少 operation 字段 |
| 49 | Error | `MISSING_REFERENCE` | ValueSource missing variableId | VariableRef 来源缺少 variableId |

### 6g. 演出配置

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 50 | Warning | `NULL_DATA` | PresentationConfig type is empty | 演出配置缺少 type |
| 51 | Error | `MISSING_REFERENCE` | Script presentation missing scriptId | Script 型演出配置缺少 scriptId |
| 52 | Error | `MISSING_REFERENCE` | Script '{id}' not found | 演出配置的脚本不存在 |
| 53 | Error | `MISSING_REFERENCE` | Graph presentation missing graphId | Graph 型演出配置缺少 graphId |
| 54 | Error | `MISSING_REFERENCE` | PresentationGraph '{id}' not found | 演出配置的演出图不存在 |

### 6h. 值来源变量引用

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 55 | Error | `MISSING_REFERENCE` | Variable '{id}' not found{scopeInfo} | COMPARISON 条件的 ValueSource 引用变量不存在 |
| 56 | Error | `MISSING_REFERENCE` | ValueSource missing variableId | VariableRef 型 ValueSource 缺少 variableId |

## 7. DataValidator.PerformanceParams.cs — Temporary 参数一致性校验

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 57 | Error | `INVALID_PARAMETER` | Temporary paramName is empty | Temporary 参数的 paramName 为空 |
| 58 | Error | `INVALID_PARAMETER` | Temporary paramName '{name}' cannot be converted to valid C# identifier | paramName 转 PascalCase 后非法 |
| 59 | Error | `INVALID_TEMP_PARAMETER_TYPE` | Temporary param '{name}' has no tempVariable.type | Temporary 参数缺少类型 |
| 60 | Error | `INVALID_TEMP_PARAMETER_TYPE` | Temporary param '{name}' has unsupported type '{type}' | 类型不在白名单（bool/int/float/string） |
| 61 | Error | `CONFLICTING_PARAMETER_TYPE` | Conflicting Temporary param type for script='{name}', param='{name}': '{typeA}' vs '{typeB}' | 同名参数在不同位置声明了不同类型 |

## 8. DataValidator.ScriptBindings.cs — 生命周期脚本多绑定检测

| # | 严重度 | 错误码 | 消息 | 触发场景 |
|---|---|---|---|---|
| 62 | Error | `MULTI_BINDING` | Node lifecycle script '{name}' is bound to multiple Nodes: [...] | 同一 Node 生命周期脚本绑定到多个 Node |
| 63 | Error | `MULTI_BINDING` | Stage lifecycle script '{name}' is bound to multiple Stages: [...] | 同一 Stage 生命周期脚本绑定到多个 Stage |
| 64 | Error | `MULTI_BINDING` | State lifecycle script '{name}' is bound to multiple States: [...] | 同一 State 生命周期脚本绑定到多个 State |

---

## 统计汇总

| 严重度 | 数量 | 说明 |
|---|---|---|
| Critical | 1 | 数据为 null，立即中止 |
| Error | 55 | 必须修复才能正确运行 |
| Warning | 8 | 可继续，但可能有问题 |
| **合计** | **64** | |
